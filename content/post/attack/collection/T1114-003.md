---
title: "电子邮件收集：
                        邮件转发规则"
date: 2023-05-15T17:17:40+08:00
draft: false
---
## 电子邮件收集：
                        邮件转发规则
攻击者可以设置电子邮件转发规则来收集敏感信息。攻击者可能会滥用电子邮件转发规则来监视受害者的活动、窃取信息，并进一步获取关于受害者或受害者组织的情报，用作进一步的攻击或操作。此外，电子邮件转发规则可以让攻击者维持对受害者电子邮件的持久访问，即使管理员重置了被入侵的凭据。大多数电子邮件客户端都允许用户创建收件箱规则，用于各种邮件功能，包括转发到不同的收件人。这些规则可以通过本地电子邮件应用程序、Web界面或命令行界面创建。信息可以转发到内部或外部收件人，没有限制限制此规则的范围。管理员也可以为具有相同注意事项和结果的用户帐户创建转发规则。任何组织内的用户或管理员（或具有有效凭据的攻击者）都可以创建规则，以自动将所有收到的消息转发到另一个接收者，根据发件人将电子邮件转发到不同的位置等。攻击者还可以利用Microsoft Messaging API（MAPI）隐藏规则，修改规则属性，使其隐藏不在Outlook、OWA或大多数Exchange管理工具中可见。在某些环境中，管理员可能能够启用作用于整个组织而不是个人收件箱的电子邮件转发规则。例如，Microsoft Exchange支持传输规则，可对组织接收的所有邮件根据用户指定的条件进行评估，然后对符合这些条件的邮件执行用户指定的操作。滥用此类功能的攻击者可能能够在组织接收的所有或特定邮件上启用转发。
### 操作示例

|ID|名称|描述|
|----|----|----|
|[G0094]()|Kimsuky|Kimsuky在受害者的电子邮件帐户上设置了自动转发规则。|
|[G1004]()|LAPSUS$|LAPSUS$已经设置了一个Office 365租户级邮件传输规则，将目标组织内外的所有电子邮件发送到新创建的帐户中。|
|[G0122]()|Silent Librarian|Silent Librarian在被攻击的电子邮件账户上设置了自动转发规则。|

### 缓解措施

|  ID   | 缓解措施  | 描述|
|  ----  | ----  |----|
|[M1047]()|Audit|企业邮件解决方案具有监控机制，可能包括定期审计自动转发规则的功能。在Exchange环境中，管理员可以使用Get-InboxRule/Remove-InboxRule和Get-TransportRule/Remove-TransportRule来发现并删除潜在的恶意自动转发和传输规则。除此之外，可以利用MAPI编辑器检查底层数据库结构，并发现自动转发规则属性的任何修改或篡改。|
|[M1042]()|Disable or Remove Feature or Program|考虑禁用外部邮件转发。|
|[M1041]()|Encrypt Sensitive Information|使用加密技术可以为发送的敏感信息提供额外的安全保障。使用公钥加密技术进行加密需要攻击者获得私钥证书和解密密钥才能解密消息。|

### 检测

|  ID   | 数据源  | 数据组件|检测|
|  ----  | ----  |----|----|
|[DS0015]()|Application Log|Application Log Content|检测自动转发规则非常具有挑战性，因为所有由于自动转发规则转发的邮件都与手动转发的邮件呈现相同的样式。而且用户可能没有意识到自动转发规则的添加，也没有怀疑自己的帐户已被攻击者入侵；仅有电子邮件转发规则并不会影响电子邮件帐户的正常使用模式或操作。这在隐藏自动转发规则的情况下尤为真实。必须检查消息跟踪日志或使用MAPI编辑器来检测修改过的规则属性值，才能可靠地检测隐藏的自动转发规则的存在。自动转发的消息通常包含特定可检测的工件（artifact），这些工件可能存在于邮件头中；这些工件都是平台特定的。例如，设置为true的X-MS-Exchange-Organization-AutoForwarded、X-MailFwdBy和X-Forwarded-To。在被管理员管理的转发过程中使用的forwardingSMTPAddress参数。所有邮件都将转发到指定的SMTP地址。但是，与典型的客户端侧规则不同的是，该消息不会显示为在邮箱中转发；它似乎是直接发送到指定的目标邮箱中。大量带有X-MS-Exchange-Organization-AutoForwarded头文件（表示自动转发）的电子邮件，而没有与转发消息外观相匹配的电子邮件，可能表明需要在管理员级别而不是用户级别进行进一步调查。在使用Exchange的环境中，监控日志以便检测电子邮件传输规则的创建或修改。|
|[DS0017]()|Command|Command Execution|在Windows系统中，通过使用New-InboxRule、Set-InboxRule、New-TransportRule和Set-TransportRule PowerShell命令来监视可疑收件箱规则的创建。|

