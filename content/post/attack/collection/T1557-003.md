---
title: "中间人攻击：DHCP欺骗"
date: 2023-05-14T20:38:48+08:00
draft: false
---

## 中间人攻击：DHCP欺骗

攻击者可能通过欺骗动态主机配置协议（DHCP）流量并在受害网络上充当恶意DHCP服务器，将网络流量重定向到攻击者拥有的系统。通过实现中间人位置，攻击者可以收集网络通信，包括传递的凭据，特别是那些通过不安全、未加密协议发送的凭据。这也可能导致后续行为，如网络嗅探或传输数据篡改。

DHCP基于客户端-服务器模型，具有两个功能：一种协议用于从DHCP服务器向客户端提供网络配置设置，另一种机制用于为客户端分配网络地址。典型的服务器-客户端交互如下：

1. 客户端广播DISCOVER消息。
2. 服务器响应一个OFFER消息，其中包含可用的网络地址。
3. 客户端广播一个REQUEST消息，其中包括提供的网络地址。
4. 服务器通过ACK消息确认，并将网络配置参数发送给客户端。

攻击者可能会在受害网络上伪造一个恶意DHCP服务器，从而使合法主机接收到恶意的网络配置。例如，恶意软件可以充当DHCP服务器，并向受害计算机提供由攻击者拥有的DNS服务器。通过恶意的网络配置，攻击者可以实现AiTM位置，将客户端流量路由通过攻击者控制的系统，并从客户端网络中收集信息。

DHCPv6客户端可以通过向All_DHCP_Relay_Agents_and_Servers组播地址发送INFORMATION-REQUEST（代码11）消息来接收网络配置信息，而无需分配IP地址。攻击者可能会使用其恶意DHCP服务器响应此请求消息，并提供恶意的网络配置。

除了建立一个AiTM位置，攻击者还可能滥用DHCP欺骗，通过产生许多广播DISCOVER消息来耗尽网络的DHCP分配池，从而进行DHCP耗尽攻击（即服务耗尽洪水）。


### 缓解措施


|  ID   | 缓解措施  | 描述|
|  ----  | ----  |----|
|[M1037]()|过滤网络流量|考虑在端口67和68上过滤来自未知或不受信任的DHCP服务器的流量。此外，可以在层交换机上启用端口安全性。此外，考虑在二层交换机上启用DHCP监听功能，以防止DHCP欺骗攻击和饥饿攻击。可以通过脚本或工具跟踪可用IP地址。另外，在网络中很少使用IPv6时，请禁止DHCPv6流量和传入路由器广告。|
|[M1031]()|网络入侵防范|能够识别表明AiTM活动的流量模式的网络入侵检测和预防系统可用于缓解网络层面的活动。|

### 检测

|  ID   | 数据源  | 数据组件|检测|
|  ----  | ----  |----|----|
| [DS0015]()  |应用程序日志| 应用程序日志内容|监视Windows日志（例如EID 1341、1342、1020和1063）以检测DHCP设置的更改。这些也可能突出显示DHCP问题，例如IP分配不足或已用完。|
| [DS0029]()  |网络流量|网络流量内容|监控网络流量，以寻找涉及DHCP的可疑/恶意行为，例如DNS和/或网关参数的更改。此外，还要监视网络流量以查找流氓DHCPv6活动。|
|[DS0029]()|网络流量|网络流量流|监控网络流量，寻找与已知AiTM行为异常相关的迹象。考虑监测涉及塑造网络流量的系统配置文件是否被修改。|