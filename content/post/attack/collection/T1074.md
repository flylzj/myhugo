---
title: "数据分阶段/数据暂存。"
date: 2023-05-15T17:17:20+08:00
draft: false
---
## 数据分阶段/数据暂存。
攻击者可能会在数据流出之前，将收集到的数据存放在一个集中的位置或目录中。数据可以被保存在单独的文件中，也可以通过“归档收集数据”等技术合并为一个文件。攻击者可以使用交互式命令行，并使用cmd和bash中的常见功能将数据复制到暂存位置[1]。在云环境中，攻击者可能会在特定的实例或虚拟机中暂存数据，然后再将其流出。攻击者可能会创建云实例，并在该实例中暂存数据[2]。攻击者可能会选择在数据从受害者网络流出之前，在集中的位置暂存数据，以最小化与其C2服务器之间的连接数量，并更好地逃避检测。
### 操作示例

|ID|名称|描述|
|----|----|----|
|[S1020]()|Kevin|Kevin可以创建目录来存储日志和其他收集的数据。[3]|
|[S0641]()|Kobalos|Kobalos可以将捕获的SSH连接凭证写入/var/run目录下带有.pid扩展名的文件中，以便进行数据泄露。[4]|
|[S1019]()|Shark|鲨鱼在外泄之前将信息储存在名为U1和U2的文件夹中。[5]|
|[G0102]()|Wizard Spider|Wizard Spider（巫师蜘蛛）使用networkdll和psfin TrickBot模块收集并准备好了凭证和网络枚举信息。[6]|

### 缓解措施
这种攻击技术基于滥用系统功能，很难通过预防控制来有效防御。
### 检测

|  ID   | 数据源  | 数据组件|检测|
|  ----  | ----  |----|----|
|[DS0017]()|Command|Command Execution|监控已执行的命令和参数，以便采取行动收集和组合文件。具备内置功能的远程访问工具可以直接与Windows API交互，以收集和复制到指定位置。也可以通过Windows系统管理工具（如Windows Management Instrumentation 和PowerShell）获取和缓存数据。|
|[DS0022]()|File|File Access|监控那些看起来从不同位置读取文件并将它们写入同一个目录或文件的进程，这可能是数据被分阶段处理的一个迹象，特别是如果这些进程被怀疑在文件上执行加密或压缩操作，例如7zip、RAR、ZIP或zlib。|
|[]()||File Creation|监视公开写入权限的目录、中心位置以及常用的暂存目录（回收站、临时文件夹等），以定期检查可能表明有暂存数据的压缩或加密数据。|
|[DS0024]()|Windows Registry|Windows Registry Key Modification|建议监控本地存储库（如Windows注册表）的访问和修改情况，特别是来自可能与恶意数据收集相关的可疑进程。|

